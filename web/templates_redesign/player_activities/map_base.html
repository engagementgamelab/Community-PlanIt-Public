{% extends "player_activities/base.html" %}
{% load i18n gmap attachment_tags avatar %}
{% block title %}{{ block.super }} | Map Response{% endblock %}

{% block game_content %}
<div class="map column-container">
    {% if activity.is_player_submitted %}
        <a href="{% url missions:mission_playercreated activity.mission.slug %}" class="btn-back">{% trans "Return" %}</a>
    {% else %}
        <a href="{% url missions:mission activity.mission.slug %}" class="btn-back">{% trans "Back to Mission" %}</a>
    {% endif %}
    
    <h1>{{ activity.name }}<span class="points">{{ activity.get_points }}</span></h1>
    {% if activity.is_player_submitted %}<div id="created-by"><a href="{% url accounts:player_profile activity.creationUser.id %}">{% avatar activity.creationUser %}</a> created by <a href="{% url accounts:player_profile activity.creationUser.id %}">{{ activity.creationUser.get_profile.screen_name }}</a></div>{% endif %}
    
    <form id="id_activity-form" enctype="multipart/form-data" action="" method="post" class="narrow">
        <div class="column-threequarter">
            {% csrf_token %}
            <input type="hidden" name="form" value="map">
            <input type="hidden" id="max_points_input" name="max_points_input" value="{{activity.maxNumMarkers}}">
        
            <div class="activity-question">
                {% include "player_activities/attachments.html" %}
                <div>{{ activity.question|safe }}</div>
                <br class="clearfix" />
            </div>

            <div class="map-controls">
                {# <label>{{activity.maxNumMarkers}}</label> #}
                <input type="text" name="google_search" id="google_search" placeholder="Search for a company or an address" />
                <button class="btn-blue add">{% trans "Add Point" %}</button>
                <button class="btn-blue rm">{% trans "Clear All Points" %}</button>
            </div>
            
            <div>
                {% for x, lat, lon in init_coords %}
                    <input type="hidden" id="init_coords{{x}}" name="init_coords{{x}}" lat="{{lat}}" lon="{{lon}}"/>
                {% endfor %}
                {{ form.map.errors }}
                <div id="map" class="google-map" data-type="Point"></div>
            </div>
        
            {% block comment %}{% endblock %}
        
            <div class="activity-response-submit">
                <img src="{% if request.user.get_profile.avatar %}{{ MEDIA_URL }}{% else %}{{ STATIC_URL }}{% endif %}/{% firstof request.user.get_profile.avatar 'img/avatar-blank.png' %}" width="36" height="36" />
                <input type="submit" id="id_activity-btn-submit" class="btn-yellow submit" value="Submit" />
            </div>
            
        </div>
    </form>
    <p class="clearfix">{% trans "Once you are done, you will be able to view everyone's responses." %}</p>
</div>
{% endblock %}


{% block js %}
    {{ block.super }}
    <script src="http://maps.google.com/maps/api/js?sensor=false&libraries=places" type="text/javascript"></script>
    <script src="{{ STATIC_URL }}js/mapit.js" type="text/javascript" charset="utf-8"></script>
    <script type="text/javascript" charset="utf-8">
        jQuery(function($) {
            $(".google-map").mapit({{map|safe|escape}});
            $(".remove-map").remove();
        });
    </script>
{% endblock %}
