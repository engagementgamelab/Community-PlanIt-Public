{% extends 'base.html' %}

{% block css %}
    {{ block.super }}
    <link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}css/citypages.css"> 
    <link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}css/quincy.css">
    <link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}css/comments.css"> 
{% endblock %}

{% block title %}{% if request.current_city %}{{ request.current_city.name }}{% else %}Welcome{% endif %}{% endblock %}

{% block body_class %}{% if game_header %}private{% else %}public{% endif %}{% endblock %}

{% block top_nav %}
<div id="top-nav">
    <ul>
        {# TODO, back to missions if in game #}
        
        
        {% if user.is_authenticated %}
            <li><a href="{% url home %}">My Game</a></li>
            <li><a href="{% url accounts:logout %}">Sign Out</a></li>
        {% else %}
            <li><a href="{% url accounts:login %}">Sign In</a></li>
        {% endif %}
    </ul>
</div>
{% endblock %}


{% block header %}
    {# Current Site: {{ request.current_site }}<br /> #}
    {# Current City: {{ request.current_city }}<br /> #}
    {# Current Game: {{ request.current_game }}<br /> #}
    {# Current Game Slug: {{ request.session.current_game_slug }}<br /> #}
    {# Current Game Slug: {{ request.session.current_game_slug }} #}
    
        {% comment %} GAME PAGE HEADER (WITH MISSION NAVIGATION) {% endcomment %}
        {% if game_header %}
        <div id="header">
            <div id="logo-container">
                <a href="{% url home %}"><img src="{{ STATIC_URL }}img/logo.png" width="80" height="51"/></a>
            </div>
            {# MISSIONS #}
            <div>
                <h1>Mission Control</h1>
                <ul id="nav-missions">
                    {% for mission in request.current_game.missions.all %}
                    {# <li> #}
                    {#     <a href="{% url missions:mission mission.slug %}" title="{{mission.title}}"> #}
                    {#         <div class="nav-missions-number">{{ forloop.counter }}</div> #}
                    {#     </a> #}
                        {# {% if forloop.last %}<div class="nav-missions-end-arrow"></div>{% endif %} #}
                    {# </li> #}
                    <li>
                        <a href="{% url missions:mission mission.slug %}">
                            <div class="nav-missions-number">{{ forloop.counter }}</div>
                            <div class="nav-missions-endsin">
                                <p class="nav-missions-endsin-label">Ends in<p>
                                <p class="nav-missions-endsin-time">4 days</p>
                            </div>
                        </a>
                        {% if forloop.last %}<div class="nav-missions-end-arrow"></div>{% endif %}
                    </li>
                    {% endfor %}
                </ul>
                <div id="mission-progress-container">
                    <div id="mission-progress-total">
                        <div id="mission-progress-marker"></div>
                        <div id="mission-progress-individual">{{ request.user.get_profile.totalPoints }}</div>
                    </div>
                </div>
            </div>
            {# MAP THE FUTURE #}
            <div id="mission-mapthefuture"><a href="{% url values:index %}">Map the Future</a></div>
        </div>
    {% else %}    
        {% comment %} CITY PAGE HEADER {% endcomment %}
        <div id="header">
            <div id="logo-container">
                <a href="http://{{ top_level_domain }}"><img src="{{ STATIC_URL }}img/logo.png" width="150" height="100" /></a>
            </div>
            <div id="header-extras-container">
                <div id="header-extras-cityname">{{ request.current_city.name }}</div>
                <div id="header-extras-citydescription">{{ request.current_city.description }}</div>
                {% if request.current_city.image %}<div id="header-extras-cityimage"><a href="{% url home %}"><img src="{{ MEDIA_URL }}{{ request.current_city.image }}" width="230" height="124" /></a></div>{% endif %}
            </div>
        </div>
    {% endif %}
{% endblock %}

{% block content %}
    <hr class="rainbow" />            
    <br />
    
    {% if game_header %}
    <div id="header-instance">
        <h1><a href="{# should link back to current mission #}">{{ request.current_game }}</a></h1>
    </div>
    {% endif %}
    
    <div class="column-full">
        <div id="column-body">
            
            {% block game_content %}
        
            {% endblock %}
        </div>
    
        {% include '_game_nav.html' %}
    </div>
{% endblock %}
