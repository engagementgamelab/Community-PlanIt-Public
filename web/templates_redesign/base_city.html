{% extends 'base.html' %}

{% block css %}
    {{ block.super }}
    <link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}css/citypages.css"> 
    <link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}css/quincy.css">
    <link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}css/comments.css"> 
{% endblock %}

{% block title %}{% if request.current_city %}{{ request.current_city.name }}{% else %}Welcome{% endif %}{% endblock %}

{% block body_class %}{% if city_header %}public{% else %}private{% endif %}{% endblock %}

{% block top_nav %}
<div id="top-nav">
    <ul>
        {% if user.is_authenticated %}
            {% if city_header %}
                <li><a href="{% url home %}">My Game</a></li>
            {% else %}
                <li><a href="{% url missions:mission request.current_game.missions.active.0.slug %}">My Game</a></li>
            {% endif %}    
            <li><a href="{% url accounts:logout %}">Sign Out</a></li>
        {% else %}
            <li><a href="{% url accounts:login %}">Sign In</a></li>
        {% endif %}
    </ul>
</div>
{% endblock %}


{% block header %}
    {% if city_header %}
        {% comment %} CITY PAGE HEADER {% endcomment %}
        <div id="header">
            <div id="logo-container">
                <a href="http://{{ top_level_domain }}"><img src="{{ STATIC_URL }}img/logo.png" width="150" height="100" /></a>
            </div>
            <div id="header-extras-container">
                <div id="header-extras-cityname">{{ request.current_city.name }}</div>
                <div id="header-extras-citydescription">{{ request.current_city.description }}</div>
                {% if request.current_city.image %}<div id="header-extras-cityimage"><a href="{% url home %}"><img src="{{ MEDIA_URL }}{{ request.current_city.image }}" width="230" height="124" /></a></div>{% endif %}
            </div>
        </div>
    {% else %}    
        {% comment %} GAME PAGE HEADER (WITH MISSION NAVIGATION) {% endcomment %}
        <div id="header">
            <div id="logo-container">
                <a href="{% url home %}"><img src="{{ STATIC_URL }}img/logo.png" width="80" height="51"/></a>
            </div>
            <div>
                <h1>Missions</h1>
                <ul id="nav-missions">
                    {% with mission as current_mission %}
                        {% for mission in request.current_game.missions.all %}
                        <li>                            
                            <a {% ifequal mission current_mission %}class="active"{% endifequal %} href="{% url missions:mission mission.slug %}" title="{{ mission.title }}"> 
                                <div class="nav-missions-number">{{ forloop.counter }}</div> 
                                {% ifequal mission current_mission %}
                                    <div class="nav-missions-endsin"> 
                                        {% if mission.is_active %}
                                            <p class="nav-missions-endsin-label">Ends in<p> 
                                            <p class="nav-missions-endsin-time">{{ mission.ends_in_days }} day{{ mission.ends_in_days|pluralize }}</p> 
                                        {% else %}
                                            <p class="nav-missions-endsin-label">Starts in<p> 
                                            <p class="nav-missions-endsin-time">{{ mission.starts_in_days }} day{{ mission.ends_in_days.day|pluralize }}</p>
                                        {% endif %}
                                    </div>
                                {% endifequal %}
                            </a> 
                        </li>
                        {% endfor %}
                    {% endwith %}
                </ul>
                <div id="mission-progress-container">
                    <div id="mission-progress-total">
                        <div id="mission-progress-marker"></div>
                        <div id="mission-progress-individual" style="width:{{ progress_percentage }}%;"> {# TODO: width decides the progress #}
                                {{ my_points_for_mission }}
                                <div id="mission-progress-individual-marker"></div>
                            </div>
                    </div>
                </div>
            </div>
            {# MAP THE FUTURE #}
            <div id="mission-mapthefuture">
                <a href="{% url values:index %}">Map the Future</a>
                <div id="mission-mapthefuture-flags-container">
                    {# TODO for token in tokens #}
                    <div class="mapthefuture-flag"></div>
                    <div class="mapthefuture-flag"></div>
                    <div class="mapthefuture-flag"></div>
                    <div class="mapthefuture-flag"></div>
                    <div class="mapthefuture-flag"></div>
                    <div class="mapthefuture-flag"></div>
                    <div class="mapthefuture-flag"></div>
                    <div class="mapthefuture-flag"></div>
                    <div class="mapthefuture-flag"></div>
                    <div class="mapthefuture-flag"></div>
                </div>
            </div>
        </div>
    {% endif %}
{% endblock %}

{% block content %}
    <hr class="rainbow" />            
    <br />
    
    {% if city_header %}
    <div id="header-instance">
        <h1>
        {% if activity %}
            <a href="{% url missions:mission activity.mission.slug %}">{{ request.current_game }}</a>
        {% elif mission %}
            <a href="{% url missions:mission mission.slug %}">{{ request.current_game }}</a>
        {% endif %}
        </h1>
    </div>
    {% endif %}
    
    <div class="column-full">
        <div id="column-body">
            
            {% block game_content %}
        
            {% endblock %}
        </div>
    
        {% include '_game_nav.html' %}
    </div>
{% endblock %}
