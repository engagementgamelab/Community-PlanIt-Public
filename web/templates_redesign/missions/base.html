{% extends "base_city.html" %}
{% load attachment_tags gmap i18n game_extras cpi_tags %}

{% block css %}
    {{ block.super }}
    <link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}missions/css/styles.css">
{% endblock %}

{% block title %}{% trans "Mission" %}{% endblock %}

{% block body_class %}{{ block.super }} section-missions{% endblock %}

{% block game_content %}
<div>
    <div class="column-container">
        <h1>{{ mission.title }}</h1>
    </div>
    <div id="mission-intro">
        <div class="column-half">
            <div class="column-container">
                <p>{{ mission.description }}</p>
            </div>
        </div>
        <div class="column-half">
            <div class="column-container">
                <div id="mission-video-container">{% embed_video mission.video %}</div>
            </div>
        </div>
    </div>
    
    <div class="column-container">
        <div id="btn-challenges" class="btn-tab left clearfix"><a class="active">Challenges</a></div>
        <div id="btn-player-challenges" class="btn-tab right"><a href="{% url activities:new mission.slug %}">You Pose the Challenges</a></div>
        <hr class="thick clearfix" />
    </div>
    
    <div class="column-container">
        <div id="mission-activities-intro">
            <p class="instructions">{% trans "By answering challenge questions you are helping plan your community, and you are earning points that move you towards accomplishing the mission." %}</p>
            <div id="mission-activities-completion">
            {% if activities and mission.is_active %}
                <div id="completion">{{ my_completed|length }}/{{ activities|length }}</div>
                <div>{% trans "challenges completed" %}</div>
            {% endif %}
            </div>
        </div>
        
        {% comment %}
            Keep these verbose for now, easier to read/debug until we launch
        {% endcomment %}
        
        {% for activity in activities %}
        {% with activity.get_points as points and activity.completed_count as completed_count and activity.activity_type_readable as activity_type %}
            {% if mission.is_expired %}
                <div class="activity  activity-inactive {{ activity_type }}">
                    <a href="{{ activity.get_overview_url }}">
                        {{ activity|trans_fallback:"name" }} 
                        {% if completed_count %}
                            {{ completed_count }} response{{ completed_count|pluralize }})
                        {% endif %}
                        <div class="mission-activity-points">{{ points }}</div>
                    </a>
                </div>
            {% else %}
                {% if mission.is_future %}
                    {# Non-started Mission #}
                    <div class="activity activity-inactive {{ activity_type }}">
                        <a>
                        {{ activity|trans_fallback:"name" }}
                        </a>
                    </div>
                {% else %}
                    {# Active Mission #}
                    {% if activity in my_completed %}
                    {#  completed activity #}
                    <div class="activity activity-completed {{ activity_type}}">
                        <a href="{{ activity.get_activity_url }}">
                            {{ activity|trans_fallback:"name" }} ({{ completed_count }} new response{{ completed_count|pluralize }})
                            <div class="mission-activity-completed"></div>
                        </a>
                    </div>
                    {% else %}
                    {# fresh activity #}
                    <div class="activity {{ activity_type }}">
                        <a href="{{ activity.get_activity_url }}">
                            {{ activity|trans_fallback:"name" }}  ({{ completed_count }} new response{{ completed_count|pluralize }})
                            <div class="mission-activity-points">{{ points }}</div>
                        </a>
                    </div>
                    {% endif %}
                {% endif %}
            {% endif %}
        {% endwith %}
        {% empty %}
            {% trans "There are currently no activities for this mission. Check back later." %}
        {% endfor %}
    </div>

</div>
{% endblock %}
