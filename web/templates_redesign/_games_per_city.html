{% load game_extras attachment_tags i18n %}
<!-- Games per City -->
<div id="games" class="games">
    <ul class="games-filter">
        <li><a data-target='games-list-current'>Games</a></li>
        {% if instances_past %}<li><a data-target='games-list-past'>Past Games</a></li>{% endif %}
    </ul>
    
    <hr class="thick" />
    {% block games_extras %}{% endblock %}
    <div class="games-filter-container">
        <!-- Current Games -->
        <div id="games-list-current" class="games-list">
            <ul class="games-list-nav">
                {% for instance in instances_current %}
                <li>
                    <a>
                        <h3>{{ instance.title }}</h3>
                        <p>
                            {# Current Game #}
                            {{ instance.for_city.name }} &bull; 
                            {% if instance.is_active %}
                                {# Active games happening right now #}
                                Happening right now!
                            {% else %}
                                {# Future games #}
                                Starts on {{ instance.start_date|date:"M j" }}
                            {% endif %}
                            {# If you're signed up for this current game #}
                            {% if instance in request.user.get_profile.instances.all %}
                                <div class="games-list-signedup">
                                    You're signed up!
                                </div>
                            {% endif %}
                        </p>
                    </a>
                </li>
                {% endfor %}
            </ul>
            <div class="games-list-details slides_container">
                {% for instance in instances_current %}
                <div>
                    
                    <div class="games-list-detail-attachment">
                        {% if instance.get_slideshow_attachment.get_att_type_display == 'Video' %}
                            {% embed_video instance.get_slideshow_attachment.url %}
                        {% else %}
                        <img class="games-list-detail-img" src="{{ MEDIA_URL }}{{ instance.get_slideshow_attachment.file }}">
                        {% endif %}
                    </div>
                    <p class="games-list-detail-description">{# instance.description|truncatewords:20 #}{{ instance.description }}</p>
                    <div id="games-list-detail-signup" class="btn-arrow">
                        {% if user.is_authenticated %}
                            {# Sign up for Instance #}
                            {% if instance in request.user.get_profile.instances.all %}
                                {# TODO: Go to this game if started! #}
                                {% if current_city %}
                                    {# they are on city page already... bring them to missions #}
                                
                                {% else %}
                                    {# bring them to the city page... #}
                                    <a href="http://{{ instance.for_city.domain }}">Get Ready for the Game</a>
                                {% endif %}
                            {% else %}
                                <a href="{% url accounts:register %}">Sign up for this game!</a>
                            {% endif %}
                        {% else %}
                            {# Authenticate, and then sign up for this instance #}
                            <a href="{% url accounts:register %}">Sign up for this game!</a>                        
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        
        
        <!-- Past Games -->
        <div id="games-list-past" class="games-list">
            <ul class="games-list-nav">
                {% for instance in instances_past %}
                <li>
                    <a>
                        <h3>{{ instance.title }}</h3>
                        <p>{{ instance.for_city.name }} &bull; Ran from {{ instance.start_date|date:"n/j/y" }} - {{ instance.end_date|date:"n/j/y" }}</p>
                    </a>
                </li>
                {% endfor %}
            </ul>
            <div class="games-list-details slides_container">
                {% for instance in instances_past %}
                <div>
                    <div class="games-list-detail-attachment">
                        {% if instance.get_slideshow_attachment.get_att_type_display == 'Video' %}
                            {% embed_video instance.get_slideshow_attachment.url %}
                        {% else %}
                        <img class="games-list-detail-img" src="{{ MEDIA_URL }}{{ instance.get_slideshow_attachment.file }}">
                        {% endif %}
                    </div>
                    <p class="games-list-detail-description">{# instance.description|truncatewords:20 #}{{ instance.description }}</p>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>
