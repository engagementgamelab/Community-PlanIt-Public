{% extends "layouts/base.html" %}
{% load gmap i18n game_extras cpi_tags %}
{% block section %}missions{% endblock %}

{% block title %}{{ mission.name }} {% trans "Mission" %}{% endblock %}
{% block page_title %}{% endblock %}

{% block main %}
<h2>{{ mission.name }}</h2>

{% if not mission.is_active %}
<p class="notice">{% trans "This mission is not currently active. You can click on the activities to see overviews, but you cannot complete them" %}.</p>
{% endif %}

{% if mission.video %}
<div class="left video">{{mission.video|safe}}</div>
{% endif %}

<div class="left description">{{mission.description|linebreaksbr}}</div>

<h3 class="clear">
{% if activities and mission.is_active %}
    {% trans "You've completed" %} {{ completed|length }}/{{ activities|length }} {% trans "activities" %}:
{% else %}
    Activities:
{% endif %}</h3>
<table class="activities">
    <tbody>
    {% for activity in activities %}
        <tr class="{% cycle 'odd' 'even' %}">

        {% if not mission.is_active %}
                <td colspan="3" class="{{activity.type.type}}_activity">
                    {{ activity|trans_fallback:"name" }}
        {% else %}
            {% if activity in completed %}
                <td class="{{activity.type.type}}_activity">
                    <a href="{{ activity.get_activity_url }}">{{ forloop.counter }} {{ activity|trans_fallback:"name" }}</a>
                </td>
                <td>{{ activity.getPoints }} {% trans "pts" %}</td> 
                <td class="final">
                    <a href="{{ activity.get_activity_url }}"><img src="{{MEDIA_URL}}img/check.png" alt="completed"></a>
                </td>
            {% else %}
                <td class="{{activity.type.type}}_activity">
                    <a href="{{ activity.get_activity_url }}">{{ forloop.counter }} {{activity|trans_fallback:"name"}}</a>
                </td>
                <td>{{ activity.getPoints }} pts</td> 
                <td class="final">
                    <a href="{{ activity.get_activity_url }}"><img src="{{MEDIA_URL}}img/go.png" alt="try it!"></a>
                </td>
            {% endif %}
        {% endif %}
        </tr>
            {% empty %}
        <tr>
            <td colspan="2">{% trans "No activities found" %}.</td>
        </tr>
    {% endfor %}
    </tbody>
</table>
{% endblock %}
