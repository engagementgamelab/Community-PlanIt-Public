{% extends "layouts/base.html" %}
{% load attachment_tags gmap i18n game_extras cpi_tags %}
{% block section %}missions{% endblock %}

{% block title %}{{ mission.name }} {% trans "Mission" %}{% endblock %}
{% block page_title %}{% endblock %}

{% block main %}
<h2>{{ mission.name }}</h2>

{% if mission.future %}
<p class="notice">{% trans "This mission has not yet started." %}  {% blocktrans with start_date=mission.start_date|date:"m/d/Y" %}Check back on {{ start_date }} to join the conversation.{% endblocktrans %}</p>
{% endif %}

{% if mission.is_expired %}
<p class="notice">{% blocktrans with end_date=mission.end_date|date:"F j, Y" %}This mission ended on {{ end_date }}.{% endblocktrans %}</p>
{% endif %}

{% if mission.video %}
<div class="left video">{% embed_video mission.video %}</div>
<div class="description" style="margin-left: 340px;">
    {{mission.description|linebreaksbr}}
</div>
{% else %}
<div class="description">
    {{mission.description|linebreaksbr}}
</div>
{% endif %}

<h3 class="clear">
{% if activities and mission.is_active %}
    {% trans "You've completed" %} {{ completed|length }}/{{ activities|length }} {% trans "activities" %}:
{% else %}
    {% trans "Activities" %}:
{% endif %}</h3>
<table class="activities">
    <tbody>
    {% for activity in activities %}
        <tr class="{% cycle 'odd' 'even' %}">

            {% if request.user.is_superuser or mission.is_expired %}
                <td colspan="3" class="{{activity.type.type}}_activity">
                    <a href="{{ activity.get_overview_url }}">{{ activity|trans_fallback:"name" }}</a>
                </td>
            {% else %}
                {% if mission.is_future %}
                        <td colspan="3" class="{{activity.type.type}}_activity">{{ activity|trans_fallback:"name" }}</td>
                {% else %}
                    {% if activity in completed %}
                        <td class="{{activity.type.type}}_activity">
                            <a href="{{ activity.get_activity_url }}">{{ activity|trans_fallback:"name" }}</a>
                        </td>
                        <td>{{ activity.getPoints }} {% trans "pts" %}</td> 
                        <td class="final">
                            <a href="{{ activity.get_activity_url }}"><img src="{{MEDIA_URL}}img/check.png" alt="completed"></a>
                        </td>
                    {% else %}
                        <td class="{{activity.type.type}}_activity">
                            <a href="{{ activity.get_activity_url }}">{{activity|trans_fallback:"name"}}</a>
                        </td>
                        <td>{{ activity.getPoints }} pts</td> 
                        <td class="final">
                            <a href="{{ activity.get_activity_url }}"><img src="{{MEDIA_URL}}img/go.png" alt="try it!"></a>
                        </td>
                    {% endif %}
                {% endif %}
            {% endif %}

        </tr>
            {% empty %}
        <tr>
            <td colspan="2">{% trans "No activities found" %}.</td>
        </tr>
    {% endfor %}
    </tbody>
</table>
{% endblock %}
