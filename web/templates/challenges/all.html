{% extends "layouts/base.html" %}
{% load game_extras %}

{% block title %}All challenges{% endblock %}
{% block page_title %}
<h2 id="page_title">Your Active Challenges</h2>
{% endblock %}

{% block section %}challenges{% endblock %}
{% block extra_body_class %}rightsidebar{% endblock %}

{% block rightsidebar %}
{% if not instance.is_expired %}
    <div class="sectionbutton">
        <a href="{% url challenges_add %}" class="button">Create a Challenge</a>
    </div>

    <div class="section">
        <h2>Completed challenges</h2>
        <div class="challenges">
            <table>
                <tbody>
                {% for challenge in request.user.player_challenges.completed %}
                    <tr class="{% cycle "odd" "even" %}">
                        <td>
                            <a href="{% url challenges_challenge challenge.challenge.pk %}">{{challenge.challenge.name}}</a>
                        </td>
                    </tr>
                {% empty %}
                    <tr class="odd">
                        <td>No completed challenges found.</td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <div class="section">
        <h2>Past Challenges</h2>
        <div class="challenges">
            <table>
                <tbody>
                {% for challenge in instance.challenges.past %}
                    <tr class="{% cycle "odd" "even" %}">
                        <td>
                            <a href="{% url challenges_challenge challenge.pk %}">{{challenge.name}}</a>
                        </td>
                    </tr>
                {% empty %}
                    <tr class="odd">
                        <td>No past challenges found.</td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
{% endif %}
{% endblock %}

{% block main %}
{% if not instance.is_expired %}
    <ul class="challenge_list">
    {% for player_challenge in request.user.player_challenges.current %}
    <li class="challenge">
        <a href="{% url challenges_challenge player_challenge.challenge.pk %}">
            {{player_challenge.challenge.name}}<span>{% get_points for completed challenge %} points</span>
            <br/>
            <span class="dates">{{player_challenge.challenge.start_date|date:"m/d/Y"}} &#8211; {{player_challenge.challenge.end_date|date:"m/d/Y"}}</span>
        </a>
    </li>
    {% empty %}
    <li>
        You do not have any current challenges. You can
        {% if new_challenges.count %}
        accept one from the list below or
        {% endif %}
        <a href="{% url challenges_add %}">create a new one</a> if you like. It's easy!
    </li>
    {% endfor %}
    </ul>

    <h2>Available Challenges</h2>
    <ul class="challenge_list">
    {% for challenge in new_challenges %}
    <li class="challenge">
        <a href="{% url challenges_challenge challenge.pk %}">
            {{challenge.name}}<span>{% get_points for completed challenge %} points</span>
            <br/>
            <span class="dates">{{challenge.start_date|date:"m/d/Y"}} &#8211; {{challenge.end_date|date:"m/d/Y"}}</span>
        </a>
    </li>
    {% empty %}
    <li>
        There are no new challenges. <a href="{% url challenges_add %}" class="button">Create one!</a>
    </li>
    {% endfor %}
    </ul>
{% else %}
    <h2>{{instance}} has ended.</h2>
    <div class="gridview listless">
        You may not add or accept new challenges.
    </div>
{% endif %}

{% endblock %}
