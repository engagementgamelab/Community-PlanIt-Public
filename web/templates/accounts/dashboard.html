{%extends "layouts/base.html"%}
{% load game_extras %}

{%block section%}accounts{%endblock%}

{%block title%}Dashboard{%endblock%}
{%block page_title%}{%endblock%}

{%block main%}
    {%if not instance.is_started%}
        {%if not user.is_active%}
            <form method="POST" action="">
                <h4>One last step: Please verify that you have read our Terms of Use and Privacy Policy. 
                It is our commitment to provide a safe, friendly environment
                for community members to discuss important values.</h4>
                {%csrf_token%}
                <div class="fieldWrapper">
                    {{ activation_form.accepted_term.errors }}
                    <label for="id_accepted_term">I have have read the <a href="/terms/" target="_blank">Terms of Use.</a></label>
                    {{ activation_form.accepted_term }}
                </div>
                <div class="fieldWrapper">
                    {{ activation_form.accepted_research.errors }}
                    <label for="id_accepted_research">I have read the <a href="/privacy/" target="_blank">Privacy Policy.</a></label>
                    {{ activation_form.accepted_research }}
                </div>
                <button class="button">Activate my account!</button>
            </form>
        {%else%}
            <p class="welcome">
                {%if not instance.is_expired%}                    
                    <span><img style="padding-bottom:25px" src="{{MEDIA_URL}}/img/Lowell_header.png"></span>
                    
                    As part of Sustainability Week, we invite you to play Community PlanIt to help 
                    shape the city's vision for a sustainable future. Earn points by completing the 
                    <a class="red" href="/mission/{{mission.slug}}" title="{{mission.topic}}">mission</a>
                    activities, which you can trade in for <a class="red" href="/value">coins</a> to spend
                    on promoting your top community values. Keep checking back from 
                    June 15 – June 25 to stay on top of the lively discussion—and tell your friends!
                
                {%else%}
                    <strong>{{instance.name}} has ended.</strong>
                {%endif%}
            </p>
            <hr class="space">
            
            <div class="twothird">
                <h3>Latest Activity</h3>
                {%if log and log|length%}
                <ul class="listless listview feed">
                    {%for activity in log%}
                    <li class="listitem {{activity.type}}">
                        {%if activity.user.get_profile.avatar%}
                            <img class="avatar" src="{{MEDIA_URL}}/{{activity.user.get_profile.avatar}}">
                        {%else%}               
                            <img class="avatar" src="{{MEDIA_URL}}/img/avatar-blank.jpg">
                        {%endif%} 
                        <a href="/player/{{activity.user.id}}">{{activity.user.get_profile.screen_name}}</a>
                        {{activity.data}} 
                        {%if activity.url%}
                            <a href="{{activity.url}}">{{activity.action}}</a>
                        {%else%}
                            {{activity.action}}
                        {%endif%}
                        <div class="timestamp fine">{{activity.date|date:"F j, Y, g:i a"}}</div>
                    </li>
                    {%endfor%}
                </ul>
                {%else%}
                    No news found.   
                {%endif%}
                <hr class="space">
                
                <p>
                <a href="/neighborhood/{{user.get_profile.instance.slug}}" class="right fine">View more community news &rarr;</a>
                </p>
            </div>
            <div class="third last">        
                <div class="modules">
                    {%if missions.current.all|length%}
                        {%for mission in missions.current.all%}
                        <h3 class="missions">Current Mission <span class="fine">(<a href="/mission/{{mission.slug}}">{{mission.topic}}</a>)</span></h3>
                        <div class="dashboardmodule">
                            <div class="dashboardmoduleinner">
                                 <ul class="listview listless">
                                     {%if not mission_activities|length == finished_activities|length%}
                                         {%for activity in unfinished_activities%}
                                             <li class="listitem game {{game.game_type}}"> <!--TODO: make this class tied to activities -->
                                                <!-- this will get the string for the type -->
                                                {%with activity.type.type as type%}
                                                    <!--TODO: make the link to the activity and insert it here -->
                                                    <a href="/mission/{{mission.slug}}/game/{{game.game_type}}/{{game.id}}">{{game.title}}
                                                        <span class="fine highlight green">{{ activity.get_points }}</span>
                                                    </a>
                                                {%endwith%}
                                                    <!-- TODO: Make this the same link as above -->
                                                 <a href="/mission/{{mission.slug}}/game/{{game.game_type}}/{{game.id}}" class="button">Go</a>
                                             </li>
                                         {%endfor%}
                                     {%else%}
                                         <h3>You completed all the actives. Great work!</h3>
                                         <h4>Go to the current mission to see all responses or change your answers.</h4>
                                     {%endif%}
                                 </ul>
                            </div>
                            <hr class="space">
                            <a class="right fine" href="/mission/{{mission.slug}}" title="{{mission.topic}}">View Current Mission &rarr;</a>
                            <hr class="space">
                        </div>
                        <hr class="space">
                        {%endfor%}
                    {%else%}
                        {%if missions.past.all|length%}
                        <label>
                            Your missions have ended for now. Great work!
                            Your community is better because of your efforts.
                            You'll be notified when a new mission starts.
                        </label>
                        {%else%}
                            {%if missions.future.all|length%}
                                <label>
                                    The mission has not yet started. You will
                                    be notified when the mission starts.
                                </label>
                            {%else%}
                                No missions created.
                            {%endif%}
                        {%endif%}
                    {%endif%}

                    <hr class="space">
                </div>
            </div>
        {%endif%}
    {%else%}
        <div> The neighborhood {{instance}} has not started yet we will alert you once it has begun.  </div>
        <br>
        <a href="/account/logout">Logout</a>
    {%endif%}

    <div style="clear:both;"></div>
{%endblock%}
