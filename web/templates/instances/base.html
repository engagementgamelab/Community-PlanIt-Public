{%extends "layouts/base.html"%}
{%load gmap%}

{%block section%}instances{%endblock%}
{%block title%}Neighborhood overview{%endblock%}
{%block page_title%}{%endblock%}

{%block main%}
    <div class="wrapper neighborhood">
        <div class="twothird">
            {%if not current_instance.is_expired%}
                <h2>{{current_instance.region}} Updates and Leaderboard</h2>
            {%else%}
                <h2>{{current_instance.region}} has ended. Updates and Leaderboard</h2>
            {%endif%}
            <p>{{current_instance.content|escape|safe}}</p>
            {{current_instance.location|show}}

            <div class="leaderboard-wrapper" style="clear:both;">
            {%if leaderboard|length%}
                <table class="leaderboard">
                    <th>Rank</th>
                    <th>Name</th>
                    <th>Points</th>

                    {%for user in leaderboard%}
                        <tr>
                            <td>{{forloop.counter}}</td>
                            <td><a href="/player/{{user.id}}">{{user.get_profile.screen_name}}</a></td>
                            <td>{{user.get_profile.points}}</td>
                        </tr>
                    {%endfor%}
                </table>
                <hr class="space">
                <a href="/list/neighborhood/{{current_instance.slug}}" class="right">View all players &rarr;</a>
            {%else%}
                No players in this neighborhood.
            {%endif%}
            </div>
        </div>
        <div class="last third">
            <h4>Neighborhood News</h4>
            {%if log|length%}
            <ul class="listless listview feed news">
                {%for activity in log%}
                <li class="listitem {{activity.type}}">
                    {%if activity.user.get_profile.avatar%}
                        <img class="avatar" src="{{MEDIA_URL}}/{{activity.user.get_profile.avatar}}">
                    {%else%}               
                        <img class="avatar" src="{{MEDIA_URL}}/img/avatar-blank.jpg">
                    {%endif%} 
                    <a href="/player/{{activity.user.id}}">{{activity.user.get_profile.screen_name}}</a>
                    {{activity.data}} 
                    {%if activity.url%}
                        <a href="{{activity.url}}">{{activity.action}}</a>
                    {%else%}
                        {{activity.action}}
                    {%endif%}
                    <div class="timestamp fine">{{activity.date|date:"F j, Y, g:i a"}}</div>
                </li>
                {%endfor%}
            </ul>
            {%else%}
                No activities created.   
            {%endif%}
            
            <hr class="space">
            
            <h4>Neighborhood Attachments</h4>
            {%if attachments|length%}
            <ul class="listless listview feed attachments">
                {%for attachment in attachments%}
                <li class="listitem {{attachment.type}}">
                    <a href="{{attachment.file.url}}">{{attachment.file.name|slice:"0:35"}}</a>
                </li>
                {%endfor%}
            </ul>
            {%else%}
                <p>No attachments added.</p>
            {%endif%}
            
        </div>
        <hr class="space">
    </div>
{%endblock%}

{%block body%}
    {%gmap_includes%}
{%endblock%}
