{%extends "layouts/base.html"%}
{% load game_extras %}

{%block section%}misisons{%endblock%}
{%block title%}Administration{%endblock%}
{%block page_title%}{%endblock%}

{%block main%}
    <h2>Missions for Instance: {{instance.name}}</h2>

    <form action="{% url value-save %}" method="post">
        {%csrf_token%}
        <input type="hidden" name="instance_id" id="instance_id" value="{{instance.id}}"/>
        <div id="missions"></div>

        <input type="button" name="add" value="Add another mission" onclick="addInput()"/> <br>
        <hr>
        
        
        <input type="submit" name="submit_btn" value="Submit" />
        <input type="submit" name="submit_btn" value="Cancel" />
    </form>
{%endblock%}

{%block body%}
    <script>
        var fields = {{values|length}}; //0 is given above
        var storeValues = new Array(0);
        var textboxArray = new Array(0);
        var missionList = new Array(0);
        
        
        function Mission(id, name, location) {
            this.id = id;
            this.name = name;
            this.location = location;
        }
        /*
        function storeValue(id, value) {
            storeValues[id] = value;
        }
        
        function display()
        {
            values = document.getElementById("missions");
            values.innerHTML = "";
            for (x in textboxArray)
            {
                if (textboxArray[x] != null)
                {
                    values.innerHTML += textboxArray[x];
                }
            }
            for (x in storeValues)
            {
                if (storeValues[x] != null)
                {
                    elem = document.getElementById("value_" + x);
                    elem.value = storeValues[x];
                }
            }
        }
        
        function appendText(id, mission_id)
        {
            textboxArray[id] = '<input id="value_' + id + '" ';
            textboxArray[id] += 'name="value_' + id + '" ';
            textboxArray[id] += 'value="" style="width: 150pt" onchange="storeValue(' + id + ', this.value)"> ';
            textboxArray[id] += '<input type="button" name="up' + id + '" value="-" onclick="moveUp(' + id + ')"/> ';
            textboxArray[id] += '<input type="button" name="down' + id + '" value="+" onclick="moveDown(' + id + ')"/> ';
            textboxArray[id] += '<input type="button" name="remove' + id + '" value="Remove" onclick="deleteInput(' + id + ')"/> ';
            textboxArray[id] += '<br>';
        }
        
        function moveUp(id) {
            if (id == 0)
                return;

            temp = storeValues[id-1];
            storeValues[id-1] = storeValues[id];
            storeValues[id] = temp;
            display();
        }
        
        function deleteInput(id) {
            textboxArray[id] = null;
            storeValues[id] = null;
            display();
        }
        
        function addInput() {
            fields++; //fields is set to the vector length, this is fine except that the next one is fields+1
            appendText(fields, -1);
            display();
            return false;
        }*/
        
        $(document).ready(function() {
            try {
            {% for x, value in values %}
                missionList[missionList.length] = new Mission({{value.id}}, "{{value.name}}", {{x}});
                
                //missionList[missionList.length] = mission;
                //storeValue({{x}}, "{{value.name}}");
                //appendText({{x}}, {{value.id}});
            {% endfor %}
                missionList[missionList.length] = new Mission(-1, "", {{values|length}})
            } catch(err)
            {
                alert(err);
            }
        });
        
    </script>
{%endblock%}